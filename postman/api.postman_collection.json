{
  "info": {
    "name": "NTG JVM Agent API",
    "_postman_id": "fd2c70f1-3777-4fa2-9f7a-4d210b0b078e",
    "description": "API collection for managing agents, knowledge and tools with Spring Authorization Server",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },

  "variable": [
    { "key": "baseUrl", "value": "http://localhost:9001" },
    { "key": "auth_code", "value": "" },
    { "key": "access_token", "value": "" },
    { "key": "refresh_token", "value": "" },
    { "key": "agentId", "value": "" },
    { "key": "knowledgeId", "value": "" },
    { "key": "chunkId", "value": "" },
    { "key": "query", "value": "example search text" },
    { "key": "toolId", "value": "" }
  ],

  "item": [
    {
      "name": "Spring Authorization Server",
      "item": [
        {
          "name": "1. Get Authorization Code",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:9000/oauth2/authorize?response_type=code&client_id=demo-client&scope=openid%20profile%20chatbot.read%20chatbot.write&redirect_uri=http://localhost:3000/auth/callback",
              "protocol": "http",
              "host": ["localhost"],
              "port": "9000",
              "path": ["oauth2", "authorize"],
              "query": [
                { "key": "response_type", "value": "code" },
                { "key": "client_id", "value": "demo-client" },
                { "key": "scope", "value": "openid profile chatbot.read chatbot.write" },
                { "key": "redirect_uri", "value": "http://localhost:3000/auth/callback" }
              ]
            }
          }
        },
        {
          "name": "2. Exchange Code for Token",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/x-www-form-urlencoded" },
              { "key": "Authorization", "value": "Basic ZGVtby1jbGllbnQ6ZGVtby1zZWNyZXQ=" }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "grant_type", "value": "authorization_code" },
                { "key": "code", "value": "{{auth_code}}" },
                { "key": "redirect_uri", "value": "http://localhost:3000/auth/callback" }
              ]
            },
            "url": {
              "raw": "http://localhost:9000/oauth2/token",
              "protocol": "http",
              "host": ["localhost"],
              "port": "9000",
              "path": ["oauth2", "token"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "pm.collectionVariables.set('access_token', jsonData.access_token);",
                  "pm.collectionVariables.set('refresh_token', jsonData.refresh_token);"
                ]
              }
            }
          ]
        },
        {
          "name": "3. Refresh Token",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/x-www-form-urlencoded" },
              { "key": "Authorization", "value": "Basic ZGVtby1jbGllbnQ6ZGVtby1zZWNyZXQ=" }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "grant_type", "value": "refresh_token" },
                { "key": "refresh_token", "value": "{{refresh_token}}" }
              ]
            },
            "url": {
              "raw": "http://localhost:9000/oauth2/token",
              "protocol": "http",
              "host": ["localhost"],
              "port": "9000",
              "path": ["oauth2", "token"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "pm.collectionVariables.set('access_token', jsonData.access_token);",
                  "pm.collectionVariables.set('refresh_token', jsonData.refresh_token);"
                ]
              }
            }
          ]
        },
        {
          "name": "4. UserInfo (OIDC)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "http://localhost:9000/userinfo",
              "protocol": "http",
              "host": ["localhost"],
              "port": "9000",
              "path": ["userinfo"]
            }
          }
        }
      ]
    },

    {
      "name": "Agent",
      "item": [
        {
          "name": "List all active agents",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents",
              "host": ["{{baseUrl}}"],
              "path": ["api","agents"]
            }
          }
        },
        {
          "name": "Get agent by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agent_id}}",
              "host": ["{{baseUrl}}"],
              "path": ["api","agents","{{agent_id}}"]
            }
          }
        },
        {
          "name": "Create a new agent",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Example Agent\",\n  \"model\": \"gpt-4\",\n  \"description\": \"Optional description\",\n  \"temperature\": 0.7\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/agents",
              "host": ["{{baseUrl}}"],
              "path": ["api","agents"]
            }
          }
        },
        {
          "name": "Update an existing agent",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Agent\",\n  \"model\": \"gpt-4\",\n  \"description\": \"Updated description\",\n  \"temperature\": 0.9\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agent_id}}",
              "host": ["{{baseUrl}}"],
              "path": ["api","agents","{{agent_id}}"]
            }
          }
        },
        {
          "name": "Soft delete an agent",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agent_id}}",
              "host": ["{{baseUrl}}"],
              "path": ["api","agents","{{agent_id}}"]
            }
          }
        }
      ]
    },

    {
      "name": "Agent Knowledge",
      "item": [
        {
          "name": "List Knowledge",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge"
          }
        },
        {
          "name": "Create Knowledge",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"User Guide\",\n  \"type\": \"DOCUMENT\",\n  \"description\": \"Imported user guide\"\n}"
            }
          }
        },
        {
          "name": "Update Knowledge",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Guide\",\n  \"type\": \"DOCUMENT\",\n  \"description\": \"Updated description\"\n}"
            }
          }
        },
        {
          "name": "Get Knowledge",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}"
          }
        },
        {
          "name": "Delete Knowledge",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}"
          }
        }
      ]
    },

    {
      "name": "Knowledge Import",
      "item": [
        {
          "name": "Upload + Create Knowledge",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              {
                "key": "accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": ""
                },
                {
                  "key": "json",
                  "type": "file",
                  "src": "knowledge.json"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/import",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "agents",
                "{{agentId}}",
                "knowledge",
                "import"
              ]
            }
          }
        }
      ]
    },

    {
      "name": "Knowledge Chunks",
      "item": [
        {
          "name": "List Chunks",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}/chunks"
          }
        },
        {
          "name": "Count Chunks",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}/chunks/count"
          }
        },
        {
          "name": "Create Chunk",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}/chunks",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"Chunk content example\",\n  \"metadata\": {\n    \"page\": 1\n  }\n}"
            }
          }
        },
        {
          "name": "Update Chunk",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}/chunks/{{chunkId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"Updated content\",\n  \"metadata\": {\n    \"page\": 2\n  }\n}"
            }
          }
        },
        {
          "name": "Import File Into Chunks",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}/chunks/import",
            "body": {
              "mode": "formdata",
              "formdata": [
                { "key": "file", "type": "file", "src": "" }
              ]
            }
          }
        },
        {
          "name": "Search Similar Chunks",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{baseUrl}}/api/agents/{{agentId}}/knowledge/{{knowledgeId}}/chunks/search?query={{query}}&topK=5"
          }
        }
      ]
    },

    {
      "name": "Tools",
      "item": [
        {
          "name": "Get All Active Tools",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/tools",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tools"]
            }
          }
        },
        {
          "name": "Get Tool by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/tools/{{toolId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tools", "{{toolId}}"]
            }
          }
        },
        {
          "name": "Create Tool",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Tool Name\",\n  \"description\": \"Description here\",\n  \"config\": {}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tools",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tools"]
            }
          }
        },
        {
          "name": "Update Tool",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Tool Name\",\n  \"description\": \"Updated description\",\n  \"config\": {}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tools/{{toolId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tools", "{{toolId}}"]
            }
          }
        },
        {
          "name": "Delete Tool",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/tools/{{toolId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tools", "{{toolId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Agent Tools",
      "item": [
        {
          "name": "List Agent Tools",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/tools",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "tools"]
            }
          }
        },
        {
          "name": "Assign Tool to Agent",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/tools/{{toolId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "tools", "{{toolId}}"]
            }
          }
        },
        {
          "name": "Unassign Tool",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/tools/{{toolId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "tools", "{{toolId}}"]
            }
          }
        }
      ]
    },

    {
      "name": "Conversation and others",
      "item": [
        {
          "name": "create conversation",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "JWT_TOKEN",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n    \"question\": \"Teach me how to improve my english\",\r\n    \"conversationId\": \"cdfa4ff6-9269-45c3-af9f-4460a7e00d89\" // Delete this field in case create new conversation\r\n    // conversationId is only used when add message to existing conversation\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "http://localhost:9001/api/conversations",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "9001",
              "path": [
                "api",
                "conversations"
              ]
            }
          },
          "response": []
        },
        {
          "name": "list conversation by user",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "JWT_TOKEN",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:9001/api/conversations/user",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "9001",
              "path": [
                "api",
                "conversations",
                "user"
              ]
            }
          },
          "response": []
        },
        {
          "name": "list role",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "JWT_TOKEN",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:9001/api/roles",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "9001",
              "path": [
                "api",
                "roles"
              ]
            }
          },
          "response": []
        },
        {
          "name": "CREATE ROLE",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "JWT_TOKEN",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n    \"name\": \"ADMIN\",\r\n    \"description\": \"ADMIN role\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "http://localhost:9001/api/roles",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "9001",
              "path": [
                "api",
                "roles"
              ]
            }
          },
          "response": []
        },
        {
          "name": "assign role",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "JWT_TOKEN",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"username\": \"testuser\",\r\n  \"roleNames\": [\"ADMIN\", \"USER\"]\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "http://localhost:9001/api/roles/assign",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "9001",
              "path": [
                "api",
                "roles",
                "assign"
              ]
            }
          },
          "response": []
        },
        {
          "name": "list message by conversation",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "JWT_TOKEN",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:9001/api/conversations/6dbcafc0-166a-4499-960d-9a98b4615088/messages",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "9001",
              "path": [
                "api",
                "conversations",
                "6dbcafc0-166a-4499-960d-9a98b4615088",
                "messages"
              ]
            }
          },
          "response": []
        },
        {
          "name": "delete conversation",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "JWT_TOKEN",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "http://localhost:9001/api/conversations/6dbcafc0-166a-4499-960d-9a98b4615088",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "9001",
              "path": [
                "api",
                "conversations",
                "6dbcafc0-166a-4499-960d-9a98b4615088"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ]
}
