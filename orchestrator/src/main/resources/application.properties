# ================================================================
# APPLICATION CONFIGURATION
# Core Spring Boot application settings
# ================================================================
spring.application.name=orchestrator
server.port=9001


# ================================================================
# PRIMARY DATASOURCE (POSTGRESQL)
# Main transactional database used by JPA/Hibernate
# ================================================================
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/ntg_jvm_agent}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:admin}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:admin}


# ================================================================
# SPRING AI VECTOR STORE (PGVECTOR) - DISABLED
# Spring AI vector store is explicitly disabled.
# The application uses a custom vector ingestion + retrieval pipeline.
# ================================================================
spring.ai.vectorstore.enabled=false
spring.ai.vectorstore.pgvector.enabled=false
spring.ai.vectorstore.pgvector.initialize-schema=false


# ================================================================
# MCP (MODEL CONTEXT PROTOCOL) CLIENT
# Enables integration with external tools via SSE:
# - Browsers
# - File systems
# - Code agents
# - Other MCP-compatible services
# ================================================================
spring.ai.mcp.client.sse.connections[0].url=http://localhost:9003


# ================================================================
# SECURITY - OAUTH2 RESOURCE SERVER
# JWT validation using centralized authorization server
# ================================================================
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://localhost:9000/oauth2/jwks


# ================================================================
# JPA & HIBERNATE CONFIGURATION
# ORM settings for PostgreSQL
# ================================================================
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.hibernate.show-sql=true
spring.jpa.hibernate.ddl-auto=none


# ================================================================
# DATABASE MIGRATION - FLYWAY
# Schema migration for orchestrator service only
# ================================================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration/orchestrator
spring.flyway.table=flyway_schema_history_orchestrator


# ================================================================
# RETRY CONFIGURATION - GLOBAL DISABLE
# Disables:
# - Spring Retry
# - Spring AI retry layers
# Custom retry is handled via Resilience4j or application logic
# ================================================================
spring.retry.enabled=false
spring.ai.retry.enabled=false
spring.ai.openai.retry.enabled=false
spring.ai.openai.client.http.retry.enabled=false


# ================================================================
# MULTIPART / FILE UPLOAD
# Used by ingestion and document upload APIs
# ================================================================
spring.servlet.multipart.max-file-size=25MB
spring.servlet.multipart.max-request-size=25MB
spring.servlet.multipart.file-size-threshold=2MB


# ================================================================
# OBSERVABILITY & TELEMETRY
# Metrics, tracing, health checks, and OpenTelemetry export
# ================================================================
management.endpoints.web.exposure.include=health,metrics,prometheus,traces
management.health.redis.enabled=true
management.metrics.tags.application=orchestrator
management.tracing.sampling.probability=${TRACING_SAMPLING_PROBABILITY:1.0}
management.otlp.tracing.endpoint=http://localhost:4318/v1/traces
management.otlp.tracing.protocol=http/protobuf


# ================================================================
# PROMETHEUS ENDPOINT SECURITY
# Basic authentication for /actuator/prometheus
# ================================================================
security.prometheus.username=${PROMETHEUS_USERNAME:prometheus}
security.prometheus.password=${PROMETHEUS_PASSWORD:password}
security.prometheus.role=${PROMETHEUS_ROLE:PROMETHEUS}


# ================================================================
# REDIS CONFIGURATION
# Used for caching, rate limiting, coordination, and locks
# ================================================================
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}


# ================================================================
# OPENAPI / SWAGGER
# Disabled by default for production safety
# ================================================================
springdoc.api-docs.enabled=${SPRINGDOC_ENABLED:false}
springdoc.swagger-ui.enabled=${SPRINGDOC_ENABLED:false}


# ================================================================
# STORAGE CONFIGURATION
# Controls object storage backend and validation limits
# ================================================================
storage.type=local
storage.local.base-path=./data/storage
storage.max-object-size-bytes=20000000


# ================================================================
# EMBEDDING WORKER (ASYNC INGESTION ENGINE)
# Controls concurrency, scaling, and polling behavior
# ================================================================
embedding.worker.min-concurrency=1
embedding.worker.max-concurrency=16
embedding.worker.step-up=1
embedding.worker.step-down=1
embedding.worker.poll-interval-ms=500


# ================================================================
# EMBEDDING & VECTOR PIPELINE (CUSTOM IMPLEMENTATION)
# Not managed by Spring AI
# ================================================================
embedding.provider=${EMBEDDING_PROVIDER:openai}
embedding.model=${EMBEDDING_MODEL:text-embedding-3-small}
embedding.dimension=${EMBEDDING_DIMENSION:1536}
embedding.vector-store.type=${EMBEDDING_VECTOR_STORE_TYPE:pgvector}


# ================================================================
# VECTOR DATABASE (BACKEND CONNECTION)
# Used by VectorStoreBackend implementations
# ================================================================
vector.db.datasource.url=${VECTOR_DB_URL:${spring.datasource.url}}
vector.db.datasource.username=${VECTOR_DB_USERNAME:${spring.datasource.username}}
vector.db.datasource.password=${VECTOR_DB_PASSWORD:${spring.datasource.password}}


# ================================================================
# LLM PROVIDER - OPENAI COMPATIBLE API
# Custom HTTP client for embeddings and chat completions
# ================================================================
llm.providers.openai.base-url=${LLM_PROVIDERS_OPENAI_BASE_URL:https://models.github.ai/inference}
llm.providers.openai.api-key=${LLM_PROVIDERS_OPENAI_API_KEY}
llm.providers.openai.embeddings-path=${LLM_PROVIDERS_OPENAI_EMBEDDINGS_PATH:/embeddings}
llm.providers.openai.completions-path=${LLM_PROVIDERS_OPENAI_COMPLETIONS_PATH:/v1/chat/completions}


# ================================================================
# DOCUMENT CHUNKING PROFILES
# Defines how documents are split before embedding
# ================================================================


# ------------------------------------------------
# SEMANTIC PROFILE
# Best for PDFs, DOCX, JSON, XML (concept-dense content)
# ------------------------------------------------
chunker.profiles.semantic.chunkSize=800
chunker.profiles.semantic.minChunkSizeChars=400
chunker.profiles.semantic.minChunkLengthToEmbed=20
chunker.profiles.semantic.maxNumChunks=3000
chunker.profiles.semantic.keepSeparator=true


# ------------------------------------------------
# SENTENCE PROFILE
# Optimized for chat logs, manuals, linear prose
# ------------------------------------------------
chunker.profiles.sentence.chunkSize=300
chunker.profiles.sentence.minChunkSizeChars=150
chunker.profiles.sentence.minChunkLengthToEmbed=5
chunker.profiles.sentence.maxNumChunks=3000
chunker.profiles.sentence.keepSeparator=true


# ------------------------------------------------
# MARKDOWN PROFILE
# Markdown-aware splitting using headings and structure
# ------------------------------------------------
chunker.profiles.markdown.chunkSize=600
chunker.profiles.markdown.minChunkSizeChars=300
chunker.profiles.markdown.minChunkLengthToEmbed=10
chunker.profiles.markdown.maxNumChunks=1000
chunker.profiles.markdown.keepSeparator=true


# ------------------------------------------------
# CODE PROFILE
# Designed for source code with small logical blocks
# ------------------------------------------------
chunker.profiles.code.chunkSize=200
chunker.profiles.code.minChunkSizeChars=100
chunker.profiles.code.minChunkLengthToEmbed=5
chunker.profiles.code.maxNumChunks=5000
chunker.profiles.code.keepSeparator=true
