# ================================================================
# APPLICATION CONFIGURATION
# ================================================================
spring.application.name=orchestrator
server.port=9001


# ================================================================
# PRIMARY DATASOURCE (PostgreSQL)
# Standard Spring datasource for transactional data
# ================================================================
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/ntg_jvm_agent}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:admin}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:admin}


# ================================================================
# VECTOR STORE CONFIGURATION (PGVECTOR)
# Used for storing embeddings for semantic search
# Separate datasource required by Spring AI VectorStore
# ================================================================
spring.ai.vectorstore.pgvector.enabled=true
spring.ai.vectorstore.pgvector.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/ntg_jvm_agent}
spring.ai.vectorstore.pgvector.datasource.username=${SPRING_DATASOURCE_USERNAME:admin}
spring.ai.vectorstore.pgvector.datasource.password=${SPRING_DATASOURCE_PASSWORD:admin}


# ================================================================
# MCP (MODEL CONTEXT PROTOCOL) CLIENT CONFIGURATION
# Enables external tools (browser, filesystem, code agents, etc)
# ================================================================
spring.ai.mcp.client.sse.connections[0].url=http://localhost:9003


# ================================================================
# SECURITY CONFIGURATION
# OAuth2 Resource Server + JWT validation
# ================================================================
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:9000


# ================================================================
# JPA & HIBERNATE CONFIGURATION
# ================================================================
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.hibernate.show-sql=true
spring.jpa.hibernate.ddl-auto=none


# ================================================================
# HIBERNATE ENVERS CONFIGURATION
# Entity auditing and versioning
# ================================================================
spring.jpa.properties.org.hibernate.envers.audit_table_suffix=_aud
spring.jpa.properties.org.hibernate.envers.revision_field_name=rev
spring.jpa.properties.org.hibernate.envers.revision_type_field_name=revtype
spring.jpa.properties.org.hibernate.envers.store_data_at_delete=true
spring.jpa.properties.org.hibernate.envers.default_schema=public
spring.jpa.properties.org.hibernate.envers.audit_strategy=org.hibernate.envers.strategy.DefaultAuditStrategy


# ================================================================
# DATABASE MIGRATION (FLYWAY)
# ================================================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration/orchestrator
spring.flyway.table=flyway_schema_history_orchestrator


# ================================================================
# GLOBAL RETRY DISABLE
# Disables Spring Retry and Spring AI retry layers
# Custom retry is handled via Resilience4j or application logic
# ================================================================
spring.ai.retry.enabled=false
spring.ai.openai.retry.enabled=false
spring.ai.openai.client.http.retry.enabled=false
spring.retry.enabled=false


# ================================================================
# MULTIPART / FILE UPLOAD LIMITS
# Used by ingestion and document upload endpoints
# ================================================================
spring.servlet.multipart.max-file-size=25MB
spring.servlet.multipart.max-request-size=25MB
spring.servlet.multipart.file-size-threshold=2MB


# ================================================================
# OBSERVABILITY & TELEMETRY
# Micrometer, Prometheus, OpenTelemetry, Health
# ================================================================
management.endpoints.web.exposure.include=health,metrics,prometheus,traces
management.health.redis.enabled=true
management.metrics.tags.application=orchestrator
management.tracing.sampling.probability=${TRACING_SAMPLING_PROBABILITY:1.0}
management.otlp.tracing.endpoint=http://localhost:4318/v1/traces
management.otlp.tracing.protocol=http/protobuf


# ================================================================
# PROMETHEUS ENDPOINT SECURITY
# Credentials used to protect /actuator/prometheus
# ================================================================
security.prometheus.username=${PROMETHEUS_USERNAME:prometheus}
security.prometheus.password=${PROMETHEUS_PASSWORD:password}
security.prometheus.role=${PROMETHEUS_ROLE:PROMETHEUS}


# ================================================================
# REDIS CONFIGURATION
# Used for caching, rate limiting, and coordination
# ================================================================
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}


# ================================================================
# OPENAPI / SWAGGER CONFIGURATION
# Disabled by default for production safety
# ================================================================
springdoc.api-docs.enabled=${SPRINGDOC_ENABLED:false}
springdoc.swagger-ui.enabled=${SPRINGDOC_ENABLED:false}


# ================================================================
# STORAGE CONFIGURATION
# Controls where files are stored and how they are validated
# ================================================================
storage.type=local
storage.local.base-path=./data/storage
storage.max-object-size-bytes=20000000


# ================================================================
# EMBEDDING WORKER CONFIGURATION (ASYNC INGEST)
# Controls concurrency & polling interval for ingestion engine
# ================================================================
embedding.worker.min-concurrency=1
embedding.worker.max-concurrency=16
embedding.worker.step-up=1
embedding.worker.step-down=1
embedding.worker.poll-interval-ms=500


# ================================================================
# CHUNKING PROFILES
# Defines rules for splitting documents into vector chunks
# ================================================================


# ------------------------------------------------
# SEMANTIC PROFILE
# Ideal for semantic-heavy formats: PDF, DOCX, JSON, XML
# ------------------------------------------------
chunker.profiles.semantic.chunkSize=800
chunker.profiles.semantic.minChunkSizeChars=400
chunker.profiles.semantic.minChunkLengthToEmbed=20
chunker.profiles.semantic.maxNumChunks=3000
chunker.profiles.semantic.keepSeparator=true


# ------------------------------------------------
# SENTENCE PROFILE
# Good for chat logs, manuals, linear text
# ------------------------------------------------
chunker.profiles.sentence.chunkSize=300
chunker.profiles.sentence.minChunkSizeChars=150
chunker.profiles.sentence.minChunkLengthToEmbed=5
chunker.profiles.sentence.maxNumChunks=3000
chunker.profiles.sentence.keepSeparator=true


# ------------------------------------------------
# MARKDOWN PROFILE
# Markdown-aware splitting for `.md` and `.txt` with headings
# ------------------------------------------------
chunker.profiles.markdown.chunkSize=600
chunker.profiles.markdown.minChunkSizeChars=300
chunker.profiles.markdown.minChunkLengthToEmbed=10
chunker.profiles.markdown.maxNumChunks=1000
chunker.profiles.markdown.keepSeparator=true


# ------------------------------------------------
# CODE PROFILE
# Chunking designed for programming languages with small blocks
# ------------------------------------------------
chunker.profiles.code.chunkSize=200
chunker.profiles.code.minChunkSizeChars=100
chunker.profiles.code.minChunkLengthToEmbed=5
chunker.profiles.code.maxNumChunks=5000
chunker.profiles.code.keepSeparator=true
